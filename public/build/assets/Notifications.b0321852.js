import{d as N,u as he,i as ke,r as u,o as Ce,b as Ve,c,e as M,f as o,w as n,g as Te,_ as U,h as m,j as i,Q as P,k as Se,l as s,x as $,aU as O,aV as z,y as x,A as d,n as v,p as G,s as Qe,F as Re,t as Le,v as h,z as De,m as w,q as Ne,aD as Ue,aE as $e,C as J,G as k,R as qe}from"./app.10579c01.js";import{Q as K}from"./QItemLabel.1f7b55df.js";import{Q as W}from"./QToggle.a02dc2d0.js";import{Q as X,a as q}from"./QSelect.32be28f9.js";import{Q as Y}from"./QBtnToggle.445cdb1e.js";import{Q as f}from"./QTd.f19052d1.js";import{Q as Be}from"./QTr.00779787.js";import{Q as Fe}from"./QTable.4d294d9e.js";import"./use-checkbox.45f82c4c.js";import"./QSeparator.0566634d.js";import"./QMarkupTable.d2f16f87.js";import"./QLinearProgress.84b4c331.js";import"./QCheckbox.bf3f01de.js";const Ae={class:"q-ma-md"},Ee=i("div",{class:"row full-width flex-center q-pt-xs myRoundTop bg-primary"},[i("div",{class:"col-11 flex flex-center"},[i("span",{class:"text-h4"},"Hack Notifications")])],-1),He={class:"row full-width q-pt-md justify-between"},Ie={class:"col-12"},je={class:"row q-gutter-sm q-pl-md"},Me={class:"col-1"},Pe={class:"col-2"},Oe={class:"text-xs"},ze={class:"col-4"},Ge={class:"text-xs"},Je={class:"row justify-end q-pt-sm"},Ke={class:"col-auto"},We={class:"text-negative"},Xe={class:"row flex-center"},Ye={class:"row flex-center"},Ze={class:"col"},et={class:"col"},tt={class:"col"},_t={__name:"Notifications",setup(lt){Te(e=>({"90e121fc":ye.value}));const Z=N(()=>U(()=>import("./index.600cd088.js"),["assets/index.600cd088.js","assets/app.10579c01.js","assets/app.4fce15f2.css"])),ee=N(()=>U(()=>import("./NotificationTimer.1f7b9104.js"),["assets/NotificationTimer.1f7b9104.js","assets/app.10579c01.js","assets/app.4fce15f2.css"])),te=N(()=>U(()=>import("./StagingDscan.221763fd.js"),["assets/StagingDscan.221763fd.js","assets/app.10579c01.js","assets/app.4fce15f2.css"]));let p=he(),le=ke("can"),ae=u(!0),oe=u(!0),T=u(!0),S=u(""),C=u(),V=u(),_=u(""),ne=u({sortBy:"region",descending:!1,page:1,rowsPerPage:0}),B=()=>{};Ce(async()=>{Echo.private("notes").listen("NotificationChanged",e=>{p.updateNotification(e.notifications)}).listen("NotificationNew",e=>{re()}),p.getNotifications().then(()=>{oe.value=!1,ae.value=!1,T.value=!1})}),Ve(async()=>{Echo.leave("notes")});let ie=async e=>{var a={text:_.value};await axios({method:"post",withCredentials:!0,data:a,url:"/api/notifications/dscan/"+e,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(l=>{_.value=""})},se=async e=>{var a={text:_.value};await axios({method:"post",withCredentials:!0,data:a,url:"/api/dscan/"+e,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(l=>{_.value=""})},re=()=>{T.value=!0,p.getNotifications().then(()=>{T.value=!1})},ue=u([{label:"Scouting",value:6},{label:"Reffed",value:2},{label:"Repairing",value:3},{label:"Secured",value:4},{label:"Hostile",value:5},{label:"New",value:1}]),de=e=>ue.value.filter(a=>a.value!=e),ce=async(e,a)=>{let l={status_id:e};await axios({method:"put",withCredentials:!0,url:"/api/notifications/"+a,data:l,headers:{Accept:"application/json","Content-Type":"application/json"}})},F=e=>{if(e.status_id==1)return"accent";if(e.status_id==2)return"negative";if(e.status_id==3)return"warning";if(e.status_id==4)return"primary";if(e.status_id==5)return"red-6";if(e.status_id==6)return"light-green darken-1"},g=u([]),Q=u(),A=c(()=>{var e=L.value.map(t=>({id:t.system.region.id,name:t.system.region.region_name}));const a=[],l=new Map;for(const t of e)l.has(t.id)||(l.set(t.id,!0),a.push({value:t.id,text:t.name}));return a.sort((t,r)=>t.text.localeCompare(r.text)),a}),me=c(()=>Q.value?A.value.filter(e=>e.text.toLowerCase().indexOf(Q.value)>-1):A.value),fe=(e,a,l)=>{a(()=>{Q.value=e.toLowerCase()})},y=u([]),R=u(),E=c(()=>{var e=L.value.map(t=>({id:t.system.constellation.id,name:t.system.constellation.constellation_name}));const a=[],l=new Map;for(const t of e)l.has(t.id)||(l.set(t.id,!0),a.push({value:t.id,text:t.name}));return a.sort((t,r)=>t.text.localeCompare(r.text)),a}),ve=c(()=>R.value?E.value.filter(e=>e.text.toLowerCase().indexOf(R.value)>-1):E.value),pe=(e,a,l)=>{a(()=>{R.value=e.toLowerCase()})},H=c(()=>g.value.length>0?p.notifications.filter(a=>g.value.some(l=>l.value===a.system.region_id)):p.notifications),I=c(()=>y.value.length>0?H.value.filter(a=>y.value.some(l=>l.value===a.system.constellation_id)):H.value),j=c(()=>C.value?I.value.filter(e=>e.item_id==C.value):I.value),L=c(()=>V.value?j.value.filter(e=>e.status_id==V.value):j.value),_e=c(()=>L.value),be=u([{name:"region",align:"left",required:!1,label:"Region",classes:"text-no-wrap",field:e=>e.system.region.region_name,format:e=>`${e}`,sortable:!1},{name:"constellation",required:!0,align:"left",label:"Constellation",classes:"text-no-wrap",field:e=>e.system.constellation.constellation_name,format:e=>`${e}`,sortable:!0,filter:!0},{name:"system",required:!0,align:"left",label:"System",classes:"text-no-wrap",field:e=>e.system.system_name,format:e=>`${e}`,sortable:!0,filter:!0},{name:"type",required:!0,align:"left",label:"Type",classes:"text-no-wrap",field:e=>e.item.item_name,format:e=>`${e}`,sortable:!0,filter:!0},{name:"timeStamp",align:"left",classes:"text-no-wrap",label:"Time Stamp",field:e=>e.timestamp,format:e=>`${e}`,sortable:!0,filter:!0},{name:"age",align:"left",required:!0,label:"Age",classes:"text-no-wrap",field:e=>e.age,format:e=>`${e}`,sortable:!0,filter:!0},{name:"status",align:"center",classes:"text-no-wrap",label:"Status",field:e=>e.status.name,format:e=>`${e}`,sortable:!0,filter:!0},{name:"actions",label:"",align:"center",classes:"text-no-wrap",sortable:!1,field:e=>e.id,format:e=>`${e}`},{name:"editedBy",label:"Edited By",align:"right",classes:"text-no-wrap",field:e=>e.user&&e.user.name?e.user.name:"Unknown",format:e=>`${e}`,sortable:!0,filter:!0}]),we=e=>"dscan/"+e,ge=e=>Date.parse(e),ye=c(()=>{let e=30;return p.size.height-e+"px"});return(e,a)=>(m(),M("div",Ae,[o(Fe,{title:"Connections",class:"myHackNotificationsTable myRound bg-webBack",rows:_e.value,columns:be.value,"table-class":" text-webway","table-header-class":" text-weight-bolder","row-key":"id","no-data-label":"No hacking notifications to show",dark:"",dense:"",filter:S.value,ref:"tableRef",rounded:"","hide-bottom":"",pagination:ne.value},{top:n(l=>[Ee,i("div",He,[i("div",Ie,[i("div",je,[i("div",Me,[o(P,{rounded:"",standout:"",dense:"",debounce:"300",modelValue:S.value,"onUpdate:modelValue":a[0]||(a[0]=t=>S.value=t),clearable:"",placeholder:"Search"},{append:n(()=>[o(Se,{name:"fa-solid fa-magnifying-glass"})]),_:1},8,["modelValue"])]),i("div",Pe,[o(X,{rounded:"",dense:"",clearable:"",standout:"","input-debounce":"0","label-color":"webway","option-value":"value","option-label":"text",modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=t=>g.value=t),options:me.value,ref:"toRegionRef",label:"Region",onClear:a[2]||(a[2]=t=>g.value=[]),onFilter:s(fe),onFilterAbort:s(B),"map-options":"","use-input":"","use-chips":"",multiple:"","input-style":" max-width: 10px; min-width: 10px"},{option:n(({itemProps:t,opt:r,selected:b,toggleOption:D})=>[o($,O(z(t)),{default:n(()=>[o(x,null,{default:n(()=>[o(K,{innerHTML:r.text},null,8,["innerHTML"])]),_:2},1024),o(x,{side:""},{default:n(()=>[o(W,{"model-value":b,"onUpdate:modelValue":xe=>D(r)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),"selected-item":n(t=>[o(q,{removable:"",onRemove:r=>t.removeAtIndex(t.index),tabindex:t.tabindex,"text-color":"white",class:"q-ma-none",color:"webChip"},{default:n(()=>[i("span",Oe,d(t.opt.text),1)]),_:2},1032,["onRemove","tabindex"])]),_:1},8,["modelValue","options","onFilter","onFilterAbort"])]),i("div",ze,[o(X,{rounded:"",clearable:"",dense:"",standout:"","input-debounce":"0","label-color":"webway","option-value":"value","option-label":"text",modelValue:y.value,"onUpdate:modelValue":a[3]||(a[3]=t=>y.value=t),options:ve.value,ref:"toConstellationRef",label:"Constellations",onClear:a[4]||(a[4]=t=>y.value=[]),onFilter:s(pe),onFilterAbort:s(B),"map-options":"","use-input":"","use-chips":"",multiple:"","input-style":" max-width: 10px; min-width: 10px"},{option:n(({itemProps:t,opt:r,selected:b,toggleOption:D})=>[o($,O(z(t)),{default:n(()=>[o(x,null,{default:n(()=>[o(K,{innerHTML:r.text},null,8,["innerHTML"])]),_:2},1024),o(x,{side:""},{default:n(()=>[o(W,{"model-value":b,"onUpdate:modelValue":xe=>D(r)},null,8,["model-value","onUpdate:modelValue"])]),_:2},1024)]),_:2},1040)]),"selected-item":n(t=>[o(q,{removable:"",onRemove:r=>t.removeAtIndex(t.index),tabindex:t.tabindex,"text-color":"white",class:"q-ma-none",color:"webChip"},{default:n(()=>[i("span",Ge,d(t.opt.text),1)]),_:2},1032,["onRemove","tabindex"])]),_:1},8,["modelValue","options","onFilter","onFilterAbort"])])]),i("div",Je,[i("div",Ke,[o(Y,{modelValue:C.value,"onUpdate:modelValue":a[5]||(a[5]=t=>C.value=t),rounded:"",unelevated:"",class:"q-pr-md",clearable:"",color:"webDark","text-color":"gray","toggle-color":"primary","toggle-text-color":"gray",options:[{label:"Ihub",value:32458},{label:"TCU",value:32226}]},null,8,["modelValue"]),o(Y,{modelValue:V.value,"onUpdate:modelValue":a[6]||(a[6]=t=>V.value=t),rounded:"",unelevated:"",clearable:"",color:"webDark","text-color":"gray","toggle-color":"primary","toggle-text-color":"gray",options:[{label:"Scouting",value:6},{label:"Reffed",value:2},{label:"Repairing",value:3},{label:"Secured",value:4},{label:"Hostile",value:5},{label:"New",value:1}]},null,8,["modelValue"])])])])])]),body:n(l=>[o(Be,{props:l},{default:n(()=>[o(f,{key:"region",props:l},{default:n(()=>[i("div",null,d(l.row.system.region.region_name),1)]),_:2},1032,["props"]),o(f,{key:"constellation",props:l},{default:n(()=>[i("div",null,d(l.row.system.constellation.constellation_name),1)]),_:2},1032,["props"]),o(f,{key:"system",props:l},{default:n(()=>[i("div",null,d(l.row.system.system_name),1)]),_:2},1032,["props"]),o(f,{key:"type",props:l},{default:n(()=>[i("div",null,d(l.row.item.item_name),1)]),_:2},1032,["props"]),o(f,{key:"timeStamp",props:l},{default:n(()=>[i("div",null,d(l.row.timestamp),1)]),_:2},1032,["props"]),o(f,{props:l,key:"age"},{default:n(()=>[i("div",null,[o(s(Z),{class:"q-pl-sm","emit-events":!1,time:s(ge)(l.row.timestamp),interval:1e3},{default:n(({hours:t,minutes:r,seconds:b})=>[i("span",We,d(t)+":"+d(r)+":"+d(b),1)]),_:2},1032,["time"])])]),_:2},1032,["props"]),o(f,{key:"status",props:l},{default:n(()=>[i("div",Xe,[s(le)("edit_notifications")?(m(),v(w,{key:0,class:"myOutLineButtonLarge",size:"md",rounded:"",color:s(F)(l.row),label:l.row.status.name},{default:n(()=>[o(G,null,{default:n(()=>[o(Qe,{style:{"min-width":"100px"}},{default:n(()=>[(m(!0),M(Re,null,Le(s(de)(l.row.status_id),(t,r)=>h((m(),v($,{clickable:"",key:r,onClick:b=>s(ce)(t.value,l.row.id)},{default:n(()=>[o(x,null,{default:n(()=>[De(d(t.label),1)]),_:2},1024)]),_:2},1032,["onClick"])),[[k],[qe]])),128))]),_:2},1024)]),_:2},1024)]),_:2},1032,["color","label"])):(m(),v(q,{key:1,class:"myOutLineButtonLarge q-ma-none",dense:"",ripple:!1,rounded:"",color:s(F)(l.row),label:l.row.status.name},null,8,["color","label"]))])]),_:2},1032,["props"]),o(f,{key:"actions",props:l},{default:n(()=>[i("div",Ye,[i("div",Ze,[o(w,{"no-caps":"",color:"accent",label:"Dscan",dense:"",outline:!l.row.dscan_id},{default:n(()=>[o(G,null,{default:n(()=>[i("div",null,[o(Ne,{class:"my-card",style:{width:"20vw"}},{default:n(()=>[o(Ue,null,{default:n(()=>[o(P,{modelValue:_.value,"onUpdate:modelValue":a[7]||(a[7]=t=>_.value=t),type:"textarea",label:"Paste your Dscan or local here"},null,8,["modelValue"])]),_:1}),o($e,{align:"between"},{default:n(()=>[l.row.dscan_id?h((m(),v(w,{key:1,rounded:"",color:"primary",label:"Update",onClick:t=>s(se)(l.row.dscan.link)},null,8,["onClick"])),[[k]]):h((m(),v(w,{key:0,rounded:"",color:"primary",label:"Submit",onClick:t=>s(ie)(l.row.id)},null,8,["onClick"])),[[k]]),h(o(w,{rounded:"",color:"negative",label:"close"},null,512),[[k]]),l.row.dscan_id?h((m(),v(w,{key:2,rounded:"",color:"info",label:"open",href:s(we)(l.row.dscan.link),target:"_blank"},null,8,["href"])),[[k]]):J("",!0)]),_:2},1024)]),_:2},1024)])]),_:2},1024)]),_:2},1032,["outline"])]),i("div",et,[o(s(te),{item:l.row},null,8,["item"])]),i("div",tt,[l.row.status_id==5||l.row.status_id==3?(m(),v(s(ee),{key:0,item:l.row},null,8,["item"])):J("",!0)])])]),_:2},1032,["props"]),o(f,{key:"editedBy",props:l},{default:n(()=>[i("div",null,d(l.row.user&&l.row.user.name?l.row.user.name:null),1)]),_:2},1032,["props"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","pagination"])]))}};export{_t as default};
