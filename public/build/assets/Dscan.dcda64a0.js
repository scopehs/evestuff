import{d as _,u as oa,i as na,ay as da,az as ia,a as ca,r as h,a2 as ra,o as ua,b as fa,c as u,e as f,j as i,f as l,w as o,aA as ma,aB as H,C as m,B as pa,q as b,l as n,ah as ga,_ as S,h as d,n as k,aC as C,A as r,z as A,aD as L,Q as va,aE as Q,m as x,s as ya,x as B,F as _a,t as ha,v as Sa,G as ka}from"./app.10579c01.js";import{Q as Ta,a as E}from"./QTabPanels.1a4b62ce.js";import{c as wa}from"./copy-to-clipboard.6e15cb25.js";const ba={class:"q-ma-md"},Ca={class:"row q-gutter-lg"},La={key:0,class:"col-9"},xa={class:"col-2"},Ea={key:0,class:"col-auto"},Ia={class:"col"},Va={class:"row justify-between items-center"},Da={class:"col-auto text-h6"},Aa={class:"col-2"},Ha={class:"col text-h6"},Qa={class:"col text-h6"},Ba={class:"col text-h6"},ja={key:0,class:"text-red"},Pa={key:1,class:"text-red"},Ua={key:2,class:"text-primary"},za={key:1,class:"col-auto text-h6"},Ra={key:2,class:"col-auto"},$a=i("span",{class:"q-ml-sm"},"There was a error with the EVE ESI while trying add the local scan. You may need to enter the scan again",-1),Ma={__name:"Dscan",setup(Ga){const I=_(()=>S(()=>import("./DscanTotal.11353d39.js"),["assets/DscanTotal.11353d39.js","assets/app.10579c01.js","assets/app.4fce15f2.css"])),j=_(()=>S(()=>import("./DscanLocal.80c75eba.js"),["assets/DscanLocal.80c75eba.js","assets/app.10579c01.js","assets/app.4fce15f2.css","assets/QImg.fef93354.js","assets/DscanLocal.b8f11a2e.css"])),P=_(()=>S(()=>import("./DscanHistoryList.b1b3fcb0.js"),["assets/DscanHistoryList.b1b3fcb0.js","assets/app.10579c01.js","assets/app.4fce15f2.css"])),U=_(()=>S(()=>import("./DscanMessage.9e99b28a.js"),["assets/DscanMessage.9e99b28a.js","assets/app.10579c01.js","assets/app.4fce15f2.css","assets/QBadge.6984755e.js","assets/QChatMessage.057585fe.js","assets/DscanMessage.f247a9ce.css"])),z=_(()=>S(()=>import("./index.600cd088.js"),["assets/index.600cd088.js","assets/app.10579c01.js","assets/app.4fce15f2.css"]));let e=oa();na("can");const R=da();let V=ia(),T=ca(),c=h(null),y=h(null),g=h(!1),p=h("total"),D=h(!1);ra(()=>{}),ua(async()=>{document.title="Evestuff - Dscan",c.value=V.params.link?V.params.link:null,Echo.private("dscanall").listen("DscanAllUpdate",a=>{a.flag.flag==1}),await $()}),fa(()=>{Echo.leave("dscansolo."+c.value),Echo.leave("dscanall")});let $=async()=>{c.value&&(await e.getDscan(c.value),e.dScanIsHistory||Echo.private("dscansolo."+c.value).listen("dScanSoloUpdate",a=>{a.flag.flag==1&&(D.value=!0),a.flag.flag==2&&(e.dScanLocalCorp=a.flag.message.corpsTotal,e.dScanLocalAlliance=a.flag.message.allianceTotal,e.dScanLocalAffiliation=a.flag.message.affiliationTotal,e.updateLocalDscan(a.flag.message.soloLocal)),a.flag.flag==3&&(e.dScanLocalCorp=a.flag.message),a.flag.flag==4&&(e.dScanLocalAlliance=a.flag.message),a.flag.flag==5&&(e.dScan=a.flag.message,e.dScanHistory=a.flag.message.history),a.flag.flag==6&&(e.dScanIsHistory=a.flag.message),a.flag.flag==7&&(e.dScanItemCategory=a.flag.message),a.flag.flag==8&&(e.dScanItemGroup=a.flag.message),a.flag.flag==9&&(e.dScanItemItem=a.flag.message),a.flag.flag==10&&(e.dScanLocalAffiliation=a.flag.message),a.flag.flag==11&&T.push({path:"/dscanisnomore"}),a.flag.flag==12&&(e.dScanMessages=a.flag.message)}))},G=u(()=>!!e.dScan),O=u(()=>e.dScan.system?e.dScan.system.system_name:"unknown"),q=u(()=>e.dScan.madeby?e.dScan.madeby.name:"unknown"),N=u(()=>e.dScan.updated_by?e.dScan.updated_by.name:"unknown"),M=u(()=>e.dScan.updated_at?e.dScan.updated_at:"unknown"),F=async()=>{g.value=!0;var a={text:y.value};await axios({method:"post",withCredentials:!0,data:a,url:"/api/dscan",headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>{g.value=!1,T.push({path:`/dscan/${t.data.link}/`})})},Y=async()=>{g.value=!0;var a={text:y.value};await axios({method:"post",withCredentials:!0,data:a,url:"/api/dscan/"+c.value,headers:{Accept:"application/json","Content-Type":"application/json"}}).then(t=>{g.value=!1,e.dScanLocalCorp=t.data.data.corpsTotal,e.dScanLocalAlliance=t.data.data.allianceTotal,e.dScan=t.data.data.dscan,e.dScanHistory=t.data.data.dscan.history,t.data.data.categoryTotals&&(e.dScanItemCategory=t.data.data.categoryTotals),t.data.data.groupTotals&&(e.dScanItemGroup=t.data.data.groupTotals),t.data.data.itemTotals&&(e.dScanItemItem=t.data.data.itemTotals),t.data.data.affiliationTotal&&(e.dScanLocalAffiliation=t.data.data.affiliationTotal),y.value=null})},J=a=>a?Date.parse(a):0,K=u(()=>c.value?"full-height justify-between":"q-gutter-lg full-height justify-end"),W=a=>a==c.value,X=a=>{T.push({path:`/dscan/${a.link}/${la(a)}`})},Z=()=>{T.push({path:`/dscan/${e.dScanLiveLink}/${p.value}`})},aa=u(()=>{let a=70;return"height:"+(e.size.height-a+"px")}),ea=u(()=>e.dScan&&e.dScan.locals&&e.dScan.locals.length>0),ta=()=>{let a="https://evestuff.apps.gnf.lt"+V.path;wa(a).then(()=>{R.notify({type:"info",message:a+" copied to your clipboard"})})},la=a=>{if(p.value=="local"){let t=0;return!a.corpsTotal||Object.values(a.corpsTotal).length==0?t=0:Object.values(a.corpsTotal).forEach(s=>{t+=s.totalInSystem}),t>0?"local":"total"}return p.value},sa=u(()=>{let a=500;return"max-height:"+(e.size.height-a+"px")});return(a,t)=>(d(),f("div",ba,[i("div",Ca,[G.value?(d(),f("div",La,[l(ma,{dense:"",modelValue:p.value,"onUpdate:modelValue":t[0]||(t[0]=s=>p.value=s),class:"text-teal"},{default:o(()=>[ea.value?(d(),k(C,{key:0,name:"local",label:"Local"})):m("",!0),l(C,{name:"total",label:"Total"}),l(C,{name:"onGrid",label:"On Grid"}),l(C,{name:"offGrid",label:"Off Grid"})]),_:1},8,["modelValue"]),l(Ta,{style:H(aa.value),modelValue:p.value,"onUpdate:modelValue":t[1]||(t[1]=s=>p.value=s),animated:""},{default:o(()=>[l(E,{name:"local"},{default:o(()=>[l(n(j))]),_:1}),l(E,{name:"total"},{default:o(()=>[l(n(I),{type:1})]),_:1}),l(E,{name:"onGrid"},{default:o(()=>[l(n(I),{type:2})]),_:1}),l(E,{name:"offGrid"},{default:o(()=>[l(n(I),{type:3})]),_:1})]),_:1},8,["style","modelValue"])])):m("",!0),i("div",xa,[i("div",{class:pa([K.value,"column"])},[c.value?(d(),f("div",Ea,[l(b,{class:"my-card"},{default:o(()=>[i("div",Ia,[i("div",Va,[i("div",Da,"System: "+r(O.value),1),i("div",Aa,[l(n(U))])])]),i("div",Ha,"Created By: "+r(q.value),1),i("div",Qa,"Edited By: "+r(N.value),1),i("div",Ba,[A(" Last Updated: "),l(n(z),{class:"q-pl-sm","emit-events":!1,time:n(J)(M.value),interval:1e3},{default:o(({hours:s,minutes:v,seconds:w})=>[s>=1?(d(),f("span",ja,r(s)+":"+r(v)+":"+r(w),1)):v>=20?(d(),f("span",Pa,r(v)+":"+r(w),1)):(d(),f("span",Ua,r(v)+":"+r(w),1))]),_:1},8,["time"])])]),_:1})])):m("",!0),n(e).dScanIsHistory?m("",!0):(d(),f("div",za,[l(b,{class:"my-card myRoundTop"},{default:o(()=>[l(L,null,{default:o(()=>[l(va,{modelValue:y.value,"onUpdate:modelValue":t[2]||(t[2]=s=>y.value=s),type:"textarea",label:"Paste your Dscan or local here"},null,8,["modelValue"])]),_:1}),l(Q,{align:"center"},{default:o(()=>[l(x,{rounded:"",color:"primary",label:"New",loading:g.value,onClick:t[3]||(t[3]=s=>n(F)())},null,8,["loading"]),c.value?(d(),k(x,{key:0,rounded:"",color:"secondary",label:"Update",loading:g.value,onClick:t[4]||(t[4]=s=>n(Y)())},null,8,["loading"])):m("",!0),n(e).dScanHistory.length||n(e).dScanIsHistory?(d(),k(x,{key:1,color:"accent",rounded:"",label:"Share",onClick:n(ta)},null,8,["onClick"])):m("",!0)]),_:1})]),_:1})])),n(e).dScanHistory.length||n(e).dScanIsHistory?(d(),f("div",Ra,[l(b,{class:"my-card myRoundTop overflow-auto",style:H(sa.value)},{default:o(()=>[l(L,{class:"q-px-none"},{default:o(()=>[l(ya,{dense:""},{default:o(()=>[n(e).dScanIsHistory?(d(),k(B,{key:0,clickable:"",onClick:t[5]||(t[5]=s=>n(Z)())},{default:o(()=>[A(" Live ")]),_:1})):m("",!0),(d(!0),f(_a,null,ha(n(e).dScanHistory,(s,v)=>(d(),k(B,{class:"myListNoPadding",clickable:"",onClick:w=>n(X)(s),active:n(W)(s.link),key:v},{default:o(()=>[l(n(P),{list:s},null,8,["list"])]),_:2},1032,["onClick","active"]))),128))]),_:1})]),_:1})]),_:1},8,["style"])])):m("",!0)],2)])]),l(ga,{modelValue:D.value,"onUpdate:modelValue":t[6]||(t[6]=s=>D.value=s),persistent:""},{default:o(()=>[l(b,{class:"myRoundTop"},{default:o(()=>[l(L,{class:"myCardHeader bg-warning text-center text-h5"},{default:o(()=>[A(" Somthing went wrong ")]),_:1}),l(L,{class:"row items-center"},{default:o(()=>[$a]),_:1}),l(Q,{align:"right"},{default:o(()=>[Sa(l(x,{rounded:"",label:"close",color:"primary"},null,512),[[ka]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}};export{Ma as default};
